<?xml version="1.0" encoding="UTF-8"?>
<api context="/pagamento" name="PagamentoAPI" xmlns="http://ws.apache.org/ns/synapse">
    <resource methods="POST" uri-template="/v1/boleto">
        <inSequence>
            <log level="custom">
                <property name="--> " value="Requisitando recebida! - /pagamento/v1/boleto/"/>
                <property expression="$body" name="body"/>
            </log>
            <property expression="$body//jsonObject/source/text()" name="source" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/target/text()" name="target" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/paymentMode/text()" name="paymentMode" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/paymentMethod/text()" name="paymentMethod" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/receiverEmail/text()" name="receiverEmail" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/currency/text()" name="currency" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/extraAmount/text()" name="extraAmount" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/itemId1/text()" name="itemId1" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/itemDescription1/text()" name="itemDescription1" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/itemAmount1/text()" name="itemAmount1" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/itemQuantity1/text()" name="itemQuantity1" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/notificationURL/text()" name="notificationURL" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/reference/text()" name="reference" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/senderName/text()" name="senderName" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/senderCPF/text()" name="senderCPF" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/senderAreaCode/text()" name="senderAreaCode" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/senderPhone/text()" name="senderPhone" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/senderEmail/text()" name="senderEmail" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/senderHash/text()" name="senderHash" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressStreet/text()" name="shippingAddressStreet" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressNumber/text()" name="shippingAddressNumber" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressComplement/text()" name="shippingAddressComplement" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressDistrict/text()" name="shippingAddressDistrict" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressPostalCode/text()" name="shippingAddressPostalCode" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressCity/text()" name="shippingAddressCity" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressState/text()" name="shippingAddressState" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingAddressCountry/text()" name="shippingAddressCountry" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingType/text()" name="shippingType" scope="default" type="STRING"/>
            <property expression="$body//jsonObject/shippingCost/text()" name="shippingCost" scope="default" type="STRING"/>
            <switch source="$ctx:target">
                <case regex="pagseguro">
                    <sequence key="PagseguroBoletoSequence"/>
                </case>
                <default>
                    <sequence key="PagseguroBoletoSequence"/>
                </default>
            </switch>
            <property name="HTTP_SC" scope="axis2" type="STRING" value="200"/>
            <respond/>
        </inSequence>
        <outSequence/>
        <faultSequence/>
    </resource>
    <resource faultSequence="APIFaultSequence" methods="POST" uri-template="/v1/eventoGalaxPay">
        <inSequence>
            <log description="eventoGalaxPayIn" level="full"/>
            <property description="eventoGalaxPayIn" expression="$body" name="eventoGalaxPayIn" scope="default" type="OM"/>
            <switch source="//event">
                <case regex="transaction.status">
                    <sequence key="CriaPedidoPorEventoPagamento"/>
                </case>
                <case regex="transaction.updateStatus">
                    <sequence key="CriaConciliacaoGalaxPaySequence"/>
                </case>
                <default>
                    <log description="Status nao processavel" level="custom">
                        <property expression="//event/text()" name="Status nao processavel"/>
                    </log>
                </default>
            </switch>
            <loopback/>
        </inSequence>
        <outSequence>
            <propertyGroup description="Retorno 204">
                <property name="HTTP_SC" scope="axis2" type="STRING" value="204"/>
                <property action="remove" name="OUT_ONLY" scope="default"/>
            </propertyGroup>
            <respond/>
        </outSequence>
    </resource>
</api>
